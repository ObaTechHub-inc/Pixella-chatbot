#!/usr/bin/env bash
# Pixella Chatbot - CLI Wrapper
# Activates virtual environment (if present) and runs Pixella entrypoint

set -Eeuo pipefail

###############################################################################
# Resolve paths
###############################################################################
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

VENV_DIR="$PROJECT_ROOT/.venv"
PYTHON_CMD="python3.11"

###############################################################################
# Check for Python command
###############################################################################
command -v "$PYTHON_CMD" >/dev/null 2>&1 || {
  echo "Pixella error: Python not found"
  exit 1
}

###############################################################################
# Detect OS and venv python
###############################################################################
case "$(uname -s)" in
  Linux*|Darwin*)
    VENV_PYTHON_BIN="$VENV_DIR/bin/python"
    ;;
  CYGWIN*|MINGW*|MSYS*)
    VENV_PYTHON_BIN="$VENV_DIR/Scripts/python.exe"
    ;;
  *)
    echo "Error: Unsupported OS"
    exit 1
    ;;
esac

###############################################################################
# Use virtualenv if it exists
###############################################################################
if [ -x "$VENV_PYTHON_BIN" ]; then
  PYTHON_CMD="$VENV_PYTHON_BIN"
fi

###############################################################################
# Execute Pixella
###############################################################################
"$PYTHON_CMD" "$PROJECT_ROOT/entrypoint.py" "$@"
